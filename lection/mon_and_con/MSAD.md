# Microsoft Active Directory

**Центральным компонентом** **Microsoft Active Directory (MS AD)** является служба **Domain Services**. В ней **храняться** **данные** о *пользователях*, *компьютерах* и *других объектов* в сети. Также используеться другими службами

Так же в **Microsoft Active Directory** включается:

- **Group Policy** - **управление** **групповыми политиками**
- **Certificate Services** - **управление** **сертификатами**
- **Federation Services** - **служба** **единого входа**, позволяет **организовать** **хранение** **учётных записей** любых служб
- **Rights Management Services** - **управление** **правами**

**Microsoft Active Directory** имееться и на **Linux**, но оно **не является** **лучшим решением**, в случае надобности следует **рассмотреть** **389 Directory Server**

## Domain Services

**Domain Services** включает в себя:

- **LDAP** - **хранение** **информации** **об объектах**, она храниться в **текстовых файлах** и доступна **всем пользователем** домена
- **Kerberos** - **аутентификация**

## Group Policy

**Групповые политики** используются для **централизованной настройки** **окружения** *пользователя*, *рабочих станций* и *серверов*. И как и в прошлом пункте, данных о них храняться в **текстовом файле**

В самих настройках есть 2 группы:

- **Компьютер**
- **Пользователи**

p.s. В версии **Windows Server 2022** лучше использовать **английскую** версию ОС, на **русской** могут **возникнуть проблемы**, так как эти **2 группы** обозначены **не явно**

**При каждом** **запуске** **компьютера** или **заходе** **пользователя** **запускается** **специальная служба**(ее запускает утилита **`gpupdate.exe`**) которая **обновляет** **политики**

Чтобы связать **групповую политику** с **объектами** **MS AD** используются **организационные единицы** (**organizational unit**). Они могут **содержать** в себе **другие объекты**. **Аналог** **огрганизационной еденицы** - **каталог**. **Огрганизационные единицы** используются для **объеденения** объектов **с одной политикой**

## Подключение клиентов

Для **ввода** **в домен** нового компьютера потребуется **корректно** **установленный контроллер домена**. **Проверка** **установки** осуществляется с помощью **`dcdiag`**(часто ошибка из-за **некорректной** настройки **DNS**)

Для каждого **клиента** в качестве **DNS сервера** **должен быть** **установлен** **адрес домен-контроллера**. **Для входа** в домен потребуется **учётная запись** **домена**

**Существует** **два варианта** включения **Linux** в домен **MS AD**: с помощью *sssd* или *winbind/samba*

Пример установки на **Linux**, вместо **apt**, можно использовать и **другой** у вас имеющий **пакетный менеджер**:

`apt -y install realmd sssd sssd-tools adcli krb5-user packagekit samba-common samba-common-bin samba-libs resolvconf`

**Проверить доступности домена**:

`realm discover mydomain.local`

**Подключиться к нему с помощью команды**:

`realm join mydomain.local`

**Создать настройку, создающую профиль, если она не была создана автоматически**:

`nano -w /etc/pam.d/common-session`

`session optional        pam_mkhomedir.so skel=/etc/skel umask=077`
